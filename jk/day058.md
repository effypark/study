# ForeignKey - Models.py 구성

모델간 관계 필드 사용  
글을 작성한 사람과, 글의 최종 수정자를 입력받아야 함.  
Django의 관계필드(Relationship Fields)의 ForeignKey를 사용하고,  
이 ForeignKey의 Primary key는 장고에서 제공하는  
user_model을 사용하기로 한다.
```
from django.contrib.auth import get_user_model
User = get_user_model()
...
class {class.Name}(models.Model):
...
	created_person = models.ForeignKey(to=User, on_delete=models.CASCADE, verbose_name='작성자', null=True, blank=True)
	last_modify_person = models.ForeignKey(to=User, on_delete=models.CASCADE, verbose_name='최종 수정자', null=True, blank=True)
```
### Migrations
모델명을 작성했으니 이제 migrations을 사용해서 DB에 적용시켜주면..

Terminal
> python manage.py makemigrations  
> SystemCheckError: System check identified some issues:

```
ERRORS:
support.{class.Name}.created_person: (fields.E304) Reverse accessor for 'support.{class.Name}.created_person' clashes with reverse accessor for 'support.{class.Name}.last_modify_person'.
        HINT: Add or change a related_name argument to the definition for 'support.{class.Name}.created_person' or 'support.{class.Name}.last_modify_person'.
support.{class.Name}.last_modify_person: (fields.E304) Reverse accessor for 'support.{class.Name}.last_modify_person' clashes with reverse accessor for 'support.{class.Name}.created_person'.
        HINT: Add or change a related_name argument to the definition for 'support.{class.Name}.last_modify_person' or 'support.{class.Name}.created_person'.
```
산뜻하게 'migrations가 불가능해요' 라고 말해주는 에러메시지

### 에러메세지 내용 찾기  
처음에는 변수명을 잘못 설정해서 그런가 하다가,  
인터넷에 찾아보니 related_name이 없어서 역관계를 다시 가져오기때문에,  
동일 class에서 created_person과 last_modify_person  
모두 User를 가져오고, Django에서는 동일한 이름을 사용할 수 없기 때문이라고 한다.  

역관계 이름을 지정하지 않았기 때문에,   
created_person은 User.{class_Name}_set.all()  
을 가지게 되고, last_modify_person또한  
User.{class_Name}_set.all()을 가지게 되는 것

동일한 이름이라, Django에서는 불가능하다고 메시지를 출력한 것

어떻게 해결하는게 좋을까?
공식문서를 읽는 도중에,   
역관계를 생성하지 않도록 하려면 related_name='+'로 하거나,   
related_name='~~~+'로 하라는 설명이 있었다.

역관계가 문제가 되는 시점이니까,  
related_name='+'를 사용하기로 했다.  
대다수의 검색결과는 related_name을 지정하는게 일반적이였지만,  
이 필드가 역관계를 어떻게 사용하는지 아직 가늠이 가지 않아서...
```
from django.contrib.auth import get_user_model
User = get_user_model()
...
class {class.Name}(models.Model):
...
	created_person = models.ForeignKey(to=User, related_name='+', on_delete=models.CASCADE, verbose_name='작성자', null=True, blank=True)
	last_modify_person = models.ForeignKey(to=User, related_name='+', on_delete=models.CASCADE, verbose_name='최종 수정자', null=True, blank=True)
```
이렇게 related_name을 사용하니,  
migrations도 무리없이 진행되고, 별도의 에러메시지 없이 진행되었다.

계속 '+'를 쓸수는 없으니까
만약 related_name을 지정해주는 방향으로 진행했다면
```
	created_person = models.ForeignKey(to=User, related_name='created_persons', on_delete=models.CASCADE, verbose_name='작성자', null=True, blank=True)
	last_modify_person = models.ForeignKey(to=User, related_name='last_modify_persons', on_delete=models.CASCADE, verbose_name='최종 수정자', null=True, blank=True)
```
로 지정할 듯 하다.

related_name    
역관계를 가지고 여러 데이터가 왔다갔다 하는 경우도 있는거 같으니  
아마 앞으로 ForeignKey를 사용할 일이 생기면 반드시  
related_name을 사용하지 않을까 싶다.
