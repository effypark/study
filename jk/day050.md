# django 다시..

꿀빨았던 클린아키텍처가 끝났으니 이제 업무 관련 커밋을 하려고 함(바빠서 업무랑 비벼버리기)


## 현재 상황
### infra...
API 서버를 만들어야 하는 상황. 간단하게 백앤드 기존 구성은  
python / django   
-> admin (template ?)
-> api (json)  

형태로 되어있는 상황  
배포는 elastic beanstalk cli로 하는 상황...  

원래는 spring boot나 node로 해볼까 고민하다가 node로 결정하고  
elastic beanstalk ci/cd 만들다가 망함.ㅋ.ㅋ.ㅋ.ㅋ.ㅋ.ㅋ

따라서 그냥 기존 django 위에 api개발해서 올리기로 결정함.  

---

admin 로그인부터 만들어야 하는 상황.

어드민 디비는 대충 해놨으니 생략 

jwt를 쓰려다가 어드민이니까 and 일반 유저도 redis에 넣어서 관리해도

될거같다고 생각함. (아마)

redis 설치하고 

django setting
```python
CACHES = {
    "default": {
        "BACKEND": "django_redis.cache.RedisCache",
        "LOCATION": "redis://127.0.0.1:6379",
        "OPTIONS": {
            "CLIENT_CLASS": "django_redis.client.DefaultClient",
        }
    }
}
```

```python
from django.core.cache import cache

    cache.set('test', data)
    get_redis = cache.get('test')
```

이따위로 쓰면 된다.

로직은

로그인 성공   
-> 유저 데이터 불러오기  
-> 유저아이디|unique_key -> encrypt  
-> decrypt된건 key, 유저 데이터는 value로 redis에 저장    
-> encrypt된건 토큰으로 사용하도록 리턴  
-> 로그인 정보가 필요한 api를 요청할 경우   
-> 토큰 확인 후 decrypt 
-> decrypt 된 문자열을 redis에 검색  
-> 있을 경우 permission 확인  

대충 요래하면 될 것 같다.