# 빌드 시 환경 구분

## 환경을 나누는 이유?
개발을 진행하다보면, 개발 환경과 배포환경을 다르게 해야하는 경우가 필연적으로 발생합니다.   

예를 들면, 기능개발을 진행 하려면 정상동작 여부를 위한 테스트가 필수적인데,
이를 하나의 환경으로 사용하게 된다면, 실서버에도 영향을 미치게 되기 때문입니다.

## \- .env
개발환경과 배포환경을 설정하는 방법으로는 환경변수 선언(.env)을 통해 구분해 줄 수 있습니다. 

[env 종류]  
\- .env.local  
\- .env.development  
\- .env.production  
\- .env.test  
 
## 기본 개념 (환경 변수)
기본적으로 node.js는 production(배포)와 development(개발), test(테스트)로 구분하여 사용한다. 
그리고 create-react-app의 실행 명령어에 따라 자동으로 NODE_ENV값이 정해진다.

```
# production 배포 env실행
$ npm run build

# development 개발 env실행
$ npm start

# test 개발 env실행
$ npm run test
```

※주의  
실행 OS에 따라 환경변수를 설정하는 방법이 다르기 때문에, 
환경 변수 설정 시 undefined가 나오는 경우가 있기 때문에, [cross-env](https://www.npmjs.com/package/cross-env) 을 설치하여 환경변수를 설정하는 것이 좋습니다.  
```
$ npm i cross-env
```

설치 후에 아래와 같이 pakage.json에서 사용 가능합니다.
```
형식: cross-env 환경변수1=값 환경변수2=값 실행명령어

ex)
"scripts": {
  "local": "cross-env REACT_APP_API_URL=localhost react-scripts start",
  "build": "cross-env REACT_APP_API_URL=999.99.99.99 react-scripts start"
},
```
리액트에서 .env 환경 설정 시 변수명에 REACT_APP_이라고 앞에 붙이지 않으면 인식 되지 않습니다. 


위의 방식으로 하면 단점은 환경변수가 노출된다는 치명적인 단점이 있기 때문에 
`.env.local`, `.env.development`, `.env.test`, `.env.production` 등의 파일을 생성하여 변수를 넣어 관리합니다.
 

### 1-1. .env.local (로컬 개발 시)
.env.local 파일은 .env를 덮어쓰는 파일로, test 환경 외의 모든 환경에서 로딩하여 사용합니다..

### 1-2. .env.development
.env.development 파일은 아래의 명령어를 이용해 호출합니다. 
보통은 `.env.development`가 일반적으로 사용되어지나,
만약 `.env.development.local`이 있다면, 우선순위에 따라 `.env.development`을 덮어쓰게 됩니다. 
```
$ npm run start
or
$ yarn start
```
실행 우선순위 (좌>우)
```
.env.development.local > .env.development > .env.local > .env
```

### 1-3. .env.production (서버 배포 시)
.env.production 파일은 배포 환경 시 동작합니다.
```
$ npm run build 
or
$ yarn build
```

실행 우선순위 (좌>우)
```
.env.development.local > .env.development > .env.local > .env
```

### 1-4.   .env.test
.env.test 파일은 테스트 환경 시 동작합니다.
```
$ npm run test
$ yarn test
```

실행 우선순위 (좌>우)
```
.env.test.local > .env.test> .env.local > .env
```